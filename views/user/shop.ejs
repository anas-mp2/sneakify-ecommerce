<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Shoe Store</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* Your existing styles remain unchanged */
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
        }
        .navbar {
            background-color: #333;
            overflow: hidden;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo img {
            width: 70px;
            height: 70px;
            margin-left: 30px;
        }
        .nav-items {
            display: flex;
            align-items: center;
            margin-left: auto;
        }
        .nav-items a {
            color: white;
            padding: 14px 20px;
            text-decoration: none;
        }
        .nav-items a:hover {
            background-color: #ddd;
            color: black;
        }
        .search {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        .search input {
            padding: 5px;
            margin-right: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .search button {
            padding: 6px;
            border-radius: 5px;
            background-color: #DB4444;
            color: white;
            border: none;
            cursor: pointer;
        }
        .search button:hover {
            background-color: #DB4444;
        }
        .search-bar {
            max-width: 500px;
            margin: 20px auto;
            display: flex;
            gap: 10px;
        }
        .search-bar .btn-primary {
            background-color: #DB4444;
            border-color: #DB4444;
        }
        .search-bar .btn-primary:hover {
            background-color: #c82333;
            border-color: #c82333;
        }
        .filter-section {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 250px;
        }
        .filter-section h5 {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.25rem;
        }
        .filter-section .form-label {
            font-size: 0.9rem;
            font-weight: 500;
        }
        .filter-section .form-select,
        .filter-section .form-control {
            font-size: 0.9rem;
            padding: 5px;
        }
        .filter-section .row {
            margin: 0;
        }
        .filter-section .col {
            padding: 0 5px;
        }
        .product-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card:hover {
            transform: scale(1.05);
        }
        .product-card img {
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin: 0 auto;
        }
        .product-card h6 {
            font-size: 1.1rem;
            margin: 10px 0;
        }
        .product-card p {
            color: #666;
            margin: 5px 0;
        }
        .btn-primary {
            background-color: #DB4444;
            border-color: #DB4444;
        }
        .btn-primary:hover {
            background-color: #c82333;
            border-color: #c82333;
        }
        .btn-outline-secondary {
            border-color: #ddd;
            color: #666;
        }
        .sort-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .sort-section .form-select {
            width: auto;
        }
        footer {
            background-color: #333;
            color: white;
            padding: 40px 80px;
            font-family: Arial, sans-serif;
        }
        .footer-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        .footer-section {
            width: 18%;
            display: flex;
            flex-direction: column;
            align-items: start;
        }
        .footer-section h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .footer-section p {
            font-size: 14px;
            margin: 5px 0;
        }
        .subscribe-box {
            display: flex;
            align-items: center;
            max-width: 250px;
            border: 1px solid white;
            color: white;
            padding: 5px;
        }
        .subscribe-box input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: white;
            padding: 10px;
        }
        .subscribe-box button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 10px 15px;
        }
        .imgdiv {
            padding-left: 6px;
            padding-top: 7px;
        }
        #qr-img {
            width: 60px;
            height: 60px;
        }
        #googleplay-img {
            height: 20px;
            width: 60%;
        }
        #appstore-img {
            height: 20px;
            width: 60%;
        }
        .qr-container {
            display: flex;
            flex-direction: row;
            align-items: start;
        }
        .qr-container img {
            width: 100px;
            margin-bottom: 5px;
        }
        .social-icons {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        .social-icons i {
            font-size: 20px;
            cursor: pointer;
            margin-top: 15px;
            margin-left: 7px;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 12px;
            border-top: 1px solid white;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <%- include('../partials/user/header') %>

    <!-- Main Content -->
    <div class="container my-5">
        <% if (error) { %>
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <%= error %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>
        <!-- Search Bar -->
        <form action="/products" method="GET" class="search-bar mx-auto d-flex">
            <input type="text" name="search" class="form-control me-2" placeholder="Search products..." value="<%= search %>">
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="/products" class="btn btn-outline-secondary ms-2">Clear</a>
        </form>

        <div class="row">
            <!-- Filters -->
            <div class="col-md-3">
                <div class="filter-section">
                    <h5>Filters</h5>
                    <form action="/products" method="GET">
                        <!-- Category Filter -->
                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <select name="category" id="category" class="form-select">
                                <option value="">All Categories</option>
                                <% categories.forEach(cat => { %>
                                    <option value="<%= cat.description %>" <%= category === cat.description ? 'selected' : '' %>><%= cat.description %></option>
                                <% }) %>
                            </select>
                        </div>

                        <!-- Price Range Filter -->
                        <div class="mb-3">
                            <label class="form-label">Price Range</label>
                            <div class="row">
                                <div class="col">
                                    <input type="number" name="minPrice" class="form-control" placeholder="Min" value="<%= minPrice %>">
                                </div>
                                <div class="col">
                                    <input type="number" name="maxPrice" class="form-control" placeholder="Max" value="<%= maxPrice %>">
                                </div>
                            </div>
                        </div>

                        <!-- Brand Filter -->
                        <div class="mb-3">
                            <label for="brand" class="form-label">Brand</label>
                            <select name="brand" id="brand" class="form-select">
                                <option value="">All Brands</option>
                                <% brands.forEach(brand => { %>
                                    <option value="<%= brand %>" <%= brand === brand ? 'selected' : '' %>><%= brand %></option>
                                <% }) %>
                            </select>
                        </div>

                        <!-- Hidden fields to preserve other query params -->
                        <input type="hidden" name="search" value="<%= search %>">
                        <input type="hidden" name="sort" value="<%= sort %>">
                        <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
                    </form>
                </div>
            </div>

            <!-- Product Listing -->
            <div class="col-md-9">
                <!-- Sorting -->
                <div class="sort-section">
                    <form action="/products" method="GET" class="d-flex">
                        <select name="sort" class="form-select w-auto me-2" onchange="this.form.submit()">
                            <option value="">Sort By</option>
                            <option value="price-low-to-high" <%= sort === 'price-low-to-high' ? 'selected' : '' %>>Price: Low to High</option>
                            <option value="price-high-to-low" <%= sort === 'price-high-to-low' ? 'selected' : '' %>>Price: High to Low</option>
                            <option value="a-z" <%= sort === 'a-z' ? 'selected' : '' %>>A - Z</option>
                            <option value="z-a" <%= sort === 'z-a' ? 'selected' : '' %>>Z - A</option>
                            <option value="new-arrivals" <%= sort === 'new-arrivals' ? 'selected' : '' %>>New Arrivals</option>
                        </select>
                        <!-- Hidden fields to preserve other query params -->
                        <input type="hidden" name="search" value="<%= search %>">
                        <input type="hidden" name="category" value="<%= category %>">
                        <input type="hidden" name="minPrice" value="<%= minPrice %>">
                        <input type="hidden" name="maxPrice" value="<%= maxPrice %>">
                        <input type="hidden" name="brand" value="<%= brand %>">
                    </form>
                </div>

                <!-- Products Grid -->
                <div class="row">
                    <% if (products.length > 0) { %>
                        <% products.forEach((product, index) => { %>
                            <div class="col-md-4 mb-4">
                                <div class="product-card">
                                    <img src="<%= product.images[0] %>" alt="<%= product.name %>" class="img-fluid">
                                    <h6><%= product.name %></h6>
                                    <p class="text-muted"><%= product.brand %></p>
                                    <div>
                                        <% 
                                            // Hardcode discount UI for specific products (e.g., first 2 products)
                                            const originalPrice = product.price;
                                            const isDiscounted = index < 2; // Apply discount to first 2 products only
                                            const discountedPrice = isDiscounted ? Math.round(originalPrice * 0.9) : originalPrice; // 10% off
                                            const couponMessage = isDiscounted ? 'Coupon "SAVE10" applied' : '';
                                            const discountPercentage = isDiscounted ? 10 : 0;
                                        %>
                                        <% if (isDiscounted) { %>
                                            <p style="text-decoration: line-through; color: #999;">₹<%= originalPrice %></p>
                                            <p style="color: #DB4444; font-weight: bold;">₹<%= discountedPrice %></p>
                                            <p style="color: green; font-size: 0.9rem;">
                                                <%= couponMessage || `${discountPercentage}% Off` %>
                                            </p>
                                        <% } else { %>
                                            <p>₹<%= originalPrice %></p>
                                        <% } %>
                                    </div>
                                    <a href="/products/<%= product._id %>" class="btn btn-primary">View Details</a>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p>No products found.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <%- include('../partials/user/footer') %>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>